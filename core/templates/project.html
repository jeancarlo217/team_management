{% load static %}

<!DOCTYPE html>
<html lang="en">

{% include 'base.html' %}

<body>

    {% include 'sidebar.html' %}

    <div class="project-body">
        <!-- Painel de Projetos -->
        <div class="project-menu">
            <div class="project-list">

                {% for project in projects %}
                    <a href="{% url 'project_id' project_id=project.id %}">
                        <div class="project-card {% if project.id == project_id %} selected-project {% endif %}">
                            <div class="project-card-info">
                                <h2>{{ project.name }}</h2>
                                <p>{{ project.description }}</p>
                            </div>
                        </div>
                    </a>
                    <div class="card-actions">
                        <a href="" class="action-btn">
                            <svg class="project-card-new-user" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="128px" height="128px" viewBox="0 0 128 128" enable-background="new 0 0 128 128" xml:space="preserve">
                                <g>
                                    <g>
                                        <path d="M8.785,119.203c-0.496-0.504-0.775-1.199-0.766-1.906c0.021-1.344,0.391-13.309,6.703-19.625    c2.912-2.914,9.012-6.07,17.983-10.561c9.574-4.785,14.883-7.639,17.33-9.953l5.395-5.102l-4.688-5.76    c-7.383-9.072-11.619-19.09-11.619-27.482c0-6.473,0-13.809,3.063-19.877C45.852,11.68,53.192,8,64.008,8    c10.814,0,18.158,3.68,21.82,10.936c3.063,6.07,3.063,13.406,3.063,19.879c0,8.391-4.234,18.408-11.621,27.482l-4.688,5.762    l5.398,5.104c1.223,1.154,3.164,2.447,5.998,4.049V72h0.324c-0.318-0.232-0.627-0.461-0.828-0.652    c8.489-10.434,13.413-22.217,13.413-32.533c0-7,0-15.713-3.918-23.482C89.438,8.338,81.549,0,64.008,0    C46.467,0,38.577,8.338,35.047,15.332c-3.922,7.77-3.922,16.48-3.922,23.482c0,10.318,4.924,22.1,13.414,32.533    c-2.027,1.918-10.387,6.098-15.41,8.607c-9.963,4.984-16.284,8.279-20.063,12.061c-8.369,8.371-9.002,22.422-9.043,25.156    c-0.045,2.852,1.057,5.609,3.063,7.648c2.004,2.031,4.742,3.18,7.598,3.18h73.295v-8H10.684    C9.975,120,9.281,119.711,8.785,119.203z M115.978,88h-4v-4c0-6.617-5.383-12-12-12s-11.999,5.383-11.999,12v4h-4    c-6.617,0-12,5.383-12,12s5.383,12,12,12h4v4c0,6.617,5.382,12,11.999,12s12-5.383,12-12v-4h4c6.617,0,12-5.383,12-12    S122.595,88,115.978,88z M115.978,104h-12v12c0,2.211-1.789,4-4,4s-4-1.789-4-4v-12H83.979c-2.211,0-4-1.789-4-4s1.789-4,4-4    h11.999V84c0-2.211,1.789-4,4-4s4,1.789,4,4v12h12c2.211,0,4,1.789,4,4S118.188,104,115.978,104z"/>
                                    </g>
                                </g>
                            </svg>
                        </a>

                        <a href="" class="action-btn">
                            <svg class="action-btn" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Capa_1" x="0px" y="0px" width="485.219px" height="485.22px" viewBox="0 0 485.219 485.22" style="enable-background:new 0 0 485.219 485.22;" xml:space="preserve">
                                <g>
                                    <path d="M467.476,146.438l-21.445,21.455L317.35,39.23l21.445-21.457c23.689-23.692,62.104-23.692,85.795,0l42.886,42.897   C491.133,84.349,491.133,122.748,467.476,146.438z M167.233,403.748c-5.922,5.922-5.922,15.513,0,21.436   c5.925,5.955,15.521,5.955,21.443,0L424.59,189.335l-21.469-21.457L167.233,403.748z M60,296.54c-5.925,5.927-5.925,15.514,0,21.44   c5.922,5.923,15.518,5.923,21.443,0L317.35,82.113L295.914,60.67L60,296.54z M338.767,103.54L102.881,339.421   c-11.845,11.822-11.815,31.041,0,42.886c11.85,11.846,31.038,11.901,42.914-0.032l235.886-235.837L338.767,103.54z    M145.734,446.572c-7.253-7.262-10.749-16.465-12.05-25.948c-3.083,0.476-6.188,0.919-9.36,0.919   c-16.202,0-31.419-6.333-42.881-17.795c-11.462-11.491-17.77-26.687-17.77-42.887c0-2.954,0.443-5.833,0.859-8.703   c-9.803-1.335-18.864-5.629-25.972-12.737c-0.682-0.677-0.917-1.596-1.538-2.338L0,485.216l147.748-36.986   C147.097,447.637,146.36,447.193,145.734,446.572z"/>
                                </g>
                            </svg>
                        </a>

                    </div>
                {% endfor %}

                <!-- Botão "Novo Projeto" fixo na base -->
                <button class="new-project-btn" id="new-project-btn">+ Adicionar um cartão</button>
            </div>
    
            <!-- Tabela de Tarefas -->
            <div class="task-table-container" id="task-table-container">
                <ul class="responsive-table">
                    <li class="table-header">
                        <div class="col col-1">Nome</div>
                        <div class="col col-2">Descrição</div>
                        <div class="col col-3">Status</div>
                        <div class="col col-4">Prazo</div>
                    </li>
                </ul>
                <ul class="responsive-table" id="task-table-body">
                    {% for task in tasks %}
                        {% if task.project_id == project_id %}
                            <li class="table-row" name="{{ task.id }}" onclick="selectTask('{{ task.id }}')">
                                <div class="col col-1">{{ task.name }}</div>
                                <div class="col col-2">{{ task.description }}</div>
                                <div class="col col-3">{{ task.status }}</div>
                                <div class="col col-4">{{ task.deadline }}</div>
                            </li>
                        {% endif %}
                    {% endfor %}
                </ul>
                <!-- Botão de Nova Task -->
                <div class="new-task-btn" id="new-task-btn">+ Nova Tarefa</div>
            </div>
    
        </div>

        {% include 'new_project_modal.html' %}

        {% include 'new_task_modal.html' %}

        <script>
            const newProject = document.getElementById('new-project-btn');
            const newTask = document.getElementById('new-task-btn');
            const projectCards = document.querySelectorAll('.project-card');
            const projectCardNewUser = document.getElementById('project-card-new-user');


            function selectTask(name) {
                // Atualizar estilo de seleção de tarefa
                document.querySelectorAll('.table-row').forEach(row => row.classList.remove('selected-task'));
                console.log(document.getElementsByName(name).classList);
                document.getElementsByName(name)[0].classList.add('selected-task');
            }


            if(newProject) {
                newProject.addEventListener('click', function() {
                    document.getElementById('modal-new-project').style.display = 'flex';
                });
            };

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modal-new-project')) {
                    document.getElementById('modal-new-project').style.display = 'none';
                }
            });



            if(newTask) {
                newTask.addEventListener('click', function() {
                    document.getElementById('modal-new-task').style.display = 'flex';
                });
            };

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modal-new-task')) {
                    document.getElementById('modal-new-task').style.display = 'none';
                }
            });


            if(projectCardNewUser) {
                projectCardNewUser.addEventListener('click', function() {
                    document.getElementById('modal-new-user-project').style.display = 'flex';
                });
            };

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modal-new-user-project')) {
                    document.getElementById('modal-new-user-project').style.display = 'none';
                }
            });
        </script>
    </div>

</body>

</html>
