{% load static %}

<!DOCTYPE html>
<html lang="en">

{% include 'base.html' %}

<body>

    {% include 'sidebar.html' %}

    <div class="project-body">
        <!-- Painel de Projetos -->
        <div class="project-menu">
            <div class="project-list">

                {% for project in projects %}
                    <a href="{% url 'project' project_id=project.id %}">
                        <div class="project-card selected-project" onclick="showTasks('{{ project.id }}')">
                            <h2>{{ project.name }}</h2>
                            <p>{{ project.description }}</p>
                        </div>
                    </a>
                {% endfor %}

                <!-- Botão "Novo Projeto" fixo na base -->
                <button class="new-project-btn" id="new-project-btn">+ Adicionar um cartão</button>
            </div>
    
            <!-- Tabela de Tarefas -->
            <div class="task-table-container" id="task-table-container">
                <ul class="responsive-table">
                    <li class="table-header">
                        <div class="col col-1">Nome</div>
                        <div class="col col-2">Descrição</div>
                        <div class="col col-3">Status</div>
                        <div class="col col-4">Prazo</div>
                    </li>
                </ul>
                <ul class="responsive-table" id="task-table-body">
                    {% for task in tasks %}
                    <li class="table-row">
                        {% if task.project_id == project_id %}
                            <div class="col col-1">{{ task.name }}</div>
                            <div class="col col-2">{{ task.description }}</div>
                            <div class="col col-3">{{ task.status }}</div>
                            <div class="col col-4">{{ task.deadline }}</div>
                        {% endif %}
                    </li>
                    {% endfor %}
                </ul>
                <!-- Botão de Nova Task -->
                <div class="new-task-btn" id="new-task-btn">+ Nova Tarefa</div>
            </div>
    
            <!-- Área de edição -->
            <div class="edit-container">
                <div class="edit-project">
                    <h3>Alterar Projeto</h3>
                    <input type="text" id="project-name" placeholder="Nome do Projeto">
                    <textarea id="project-description" placeholder="Descrição"></textarea>
                    <button class="save-btn" onclick="saveProject()">Salvar Projeto</button>
                </div>
                <div class="edit-task">
                    <h3>Alterar Task</h3>
                    <input type="text" id="task-name" placeholder="Nome da Task">
                    <textarea id="task-description" placeholder="Descrição"></textarea>
                    <select id="task-status">
                        <option value="Pending">Pendente</option>
                        <option value="In Progress">Em Progresso</option>
                        <option value="Completed">Concluído</option>
                    </select>
                    <input type="date" id="task-deadline">
                    <button class="save-btn" onclick="saveTask()">Salvar Task</button>
                </div>
            </div>
        </div>

        {% include 'new_project_modal.html' %}

        {% include 'new_task_modal.html' %}

        <script>
            const newProject = document.getElementById('new-project-btn');
            const newTask = document.getElementById('new-task-btn');

            function showTasks(projectId) {
                const taskTableBody = document.getElementById('task-table-body');
                taskTableBody.innerHTML = '';

                const row = document.createElement('li');
                row.classList.add('table-row');
                /*row.setAttribute('onclick', `selectTask('${task.name}', '${task.description}', '${task.status}', '${task.deadline}')`);*/
                row.innerHTML = `
                    
                `;
                taskTableBody.appendChild(row);

                // Atualizar estilo de seleção do projeto
                document.querySelectorAll('.project-card').forEach(card => card.classList.remove('selected-project'));
                event.currentTarget.classList.add('selected-project');
            }

            function selectTask(name, description, status, deadline) {
                // Atualizar os campos de edição de tarefa
                document.getElementById('task-name').value = name;
                document.getElementById('task-description').value = description;
                document.getElementById('task-status').value = status;
                document.getElementById('task-deadline').value = deadline;

                // Atualizar estilo de seleção de tarefa
                document.querySelectorAll('.table-row').forEach(row => row.classList.remove('selected-task'));
                event.currentTarget.classList.add('selected-task');
            }

            function saveProject() {
                alert('Projeto atualizado!'); // Placeholder para salvar projeto
            }

            function saveTask() {
                alert('Task atualizada!'); // Placeholder para salvar task
            }



            if(newProject) {
                newProject.addEventListener('click', function() {
                    document.getElementById('modal-new-project').style.display = 'flex';
                });
            };

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modal-new-project')) {
                    document.getElementById('modal-new-project').style.display = 'none';
                }
            });



            if(newTask) {
                newTask.addEventListener('click', function() {
                    document.getElementById('modal-new-task').style.display = 'flex';
                });
            };

            window.addEventListener('click', function(event) {
                if (event.target === document.getElementById('modal-new-task')) {
                    document.getElementById('modal-new-task').style.display = 'none';
                }
            });
        </script>
    </div>

</body>

</html>
